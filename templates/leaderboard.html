<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>üèÜ LottoLife Leaderboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="theme-color" content="#0b1222" />
<link rel="manifest" href="/static/manifest.json">
<link rel="apple-touch-icon" href="/static/icons/lotto-192.png">
<link href="https://fonts.googleapis.com/css2?family=Jost:wght@400;600;700&display=swap" rel="stylesheet">
<style>
  :root{--bg:#050810;--panel:#0f1730;--line:#1b233a;--brand:#0d6efd;--muted:#98a8ce;}
  *{box-sizing:border-box}
  body{font-family:'Jost',sans-serif;background:radial-gradient(1000px 680px at 65% -10%,rgba(13,110,253,.18),rgba(5,8,16,.98)),#050810;color:#f0f4ff;margin:0;min-height:100vh}
  header{background:#0b1222;border-bottom:2px solid rgba(13,110,253,.4);box-shadow:0 10px 40px rgba(5,8,16,.6);position:sticky;top:0;z-index:20}
  nav{max-width:1100px;margin:auto;padding:14px 18px;display:flex;gap:10px;flex-wrap:wrap;align-items:center;justify-content:space-between}
  nav .links{display:flex;gap:10px;flex-wrap:wrap}
  nav a{color:#fff;text-decoration:none;padding:10px 18px;border-radius:12px;border:1px solid rgba(13,110,253,.3);background:rgba(15,24,48,.85);font-weight:600;transition:.25s}
  nav a:hover{background:var(--brand);border-color:transparent}
  nav a.active{background:var(--brand);border-color:transparent;box-shadow:0 14px 36px rgba(13,110,253,.4)}
  main{max-width:1100px;margin:50px auto;padding:0 20px 60px}
  h1{margin:0;font-size:2.3rem;font-weight:800}
  .lead{color:#9fb4e8;margin:8px 0 24px}
  .board{background:var(--panel);border-radius:24px;border:1px solid rgba(124,92,255,.18);padding:24px;box-shadow:0 26px 70px rgba(5,8,18,.6)}
  table{width:100%;border-collapse:collapse}
  th,td{padding:14px 10px;text-align:left;border-bottom:1px solid var(--line);font-size:15px}
  th{font-size:12px;text-transform:uppercase;letter-spacing:.08em;color:#9fb2df}
  tbody tr:nth-child(odd){background:rgba(255,255,255,0.01)}
  .rank{font-weight:800;font-size:18px}
  .pill{display:inline-flex;align-items:center;gap:6px;padding:4px 10px;border-radius:999px;background:rgba(13,110,253,0.18);color:#9fb7ff;font-size:12px}
  .empty{padding:26px;text-align:center;color:#9fb4e8}
  footer{text-align:center;color:#8fa3d1;margin:40px 0}
  @media(max-width:720px){nav{flex-direction:column;align-items:flex-start}nav .links{width:100%}}
</style>
</head>
<body>
<header>
  <nav>
    <div class="links">
      <a href="/game">üéÆ Simulator</a>
      <a href="/leaderboard" class="active">üèÜ Leaderboard</a>
      <a href="/guide">üìò Guide</a>
      <a href="/start">üé∞ Start</a>
    </div>
    <a href="/guide" style="color:#9fb4ff;text-decoration:none;font-weight:600">Tips & strategies ‚Üí</a>
  </nav>
</header>
<main>
  <h1>üèÜ LottoLife Hall of Fame</h1>
  <p class="lead">These players survived the whirlwind, kept (most of) their fortune, and left a mark through business wins and philanthropy. Update your run from inside the game to appear here‚Äîcharities and reputation are tracked now.</p>
  <div class="board">
    <table>
      <thead>
        <tr>
          <th>Rank</th>
          <th>Player</th>
          <th>State</th>
          <th>Net Worth</th>
          <th>Peak Net</th>
          <th>Day</th>
          <th>Reputation</th>
          <th>Happiness</th>
          <th>Charity Impact</th>
          <th>Taxes Paid</th>
        </tr>
      </thead>
      <tbody id="leaderboardBody">
        {% for p in players %}
        <tr>
          <td class="rank">#{{ loop.index }}</td>
          <td>
            <div>{{ p['name'] or 'Player' }}</div>
            {% if p['goal'] %}<div class="pill">{{ p['goal'] }}</div>{% endif %}
          </td>
          <td>{{ p['state'] }}</td>
          <td>${{ '{:,.0f}'.format(p['net']) }}</td>
          <td>${{ '{:,.0f}'.format(p['high_net'] or p['net']) }}</td>
          <td>Day {{ p['day'] or 0 }}</td>
          <td>{{ '%.0f'|format(p['rep']) }}</td>
          <td>{{ '%.0f'|format(p['happiness'] or 0) }}%</td>
          <td>
            <div>${{ '{:,.0f}'.format(p['charity_given'] or 0) }} total</div>
            {% if p['top_charity'] %}<div class="pill">{{ p['top_charity'] }} ‚Ä¢ {{ p['charity_count'] }} orgs</div>{% else %}<div class="pill" style="background:rgba(239,68,68,0.18);color:#fca5a5">No foundations yet</div>{% endif %}
          </td>
          <td>${{ '{:,.0f}'.format(p['taxes_paid'] or 0) }}</td>
        </tr>
        {% else %}
        <tr><td colspan="9" class="empty">No runs posted yet. Finish the tutorial in game and press ‚ÄúUpdate Leaderboard.‚Äù</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</main>
<footer>üíº Follow <a href="https://instagram.com/trackyoursheets" style="color:#cfe1ff" target="_blank">@trackyoursheets</a> for updates and challenges.</footer>
<script>
if ('serviceWorker' in navigator){
  navigator.serviceWorker.register('/static/js/sw.js').catch(()=>{});
}
const leaderboardBody = document.querySelector('#leaderboardBody');
const hasIntl = typeof Intl !== 'undefined' && Intl.NumberFormat;
const currencyStandard = hasIntl ? new Intl.NumberFormat(undefined,{style:'currency',currency:'USD',maximumFractionDigits:0}) : null;
const currencyCompact = hasIntl ? new Intl.NumberFormat(undefined,{style:'currency',currency:'USD',notation:'compact',maximumFractionDigits:1}) : null;
const numberFormatter = hasIntl ? new Intl.NumberFormat(undefined,{maximumFractionDigits:0}) : null;

function formatCurrency(value){
  const val = Number(value||0);
  if (!Number.isFinite(val)) return '$0';
  if (!hasIntl){
    const full = `$${Math.round(val).toLocaleString()}`;
    return full.length > 12 ? `$${(val/1_000_000).toFixed(1)}M` : full;
  }
  const full = currencyStandard.format(val);
  return full.length > 12 ? currencyCompact.format(val) : full;
}

function formatNumber(value){
  const val = Number(value||0);
  if (!Number.isFinite(val)) return '0';
  return hasIntl ? numberFormatter.format(val) : Math.round(val).toLocaleString();
}

function escapeHtml(value){
  return String(value ?? '').replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]));
}

function renderLeaderboard(rows){
  if (!leaderboardBody) return;
  if (!rows.length){
    leaderboardBody.innerHTML = '<tr><td colspan="9" class="empty">No runs posted yet. Finish the tutorial in game and press ‚ÄúUpdate Leaderboard.‚Äù</td></tr>';
    return;
  }
  leaderboardBody.innerHTML = rows.map((p, idx)=>{
    const goal = p.goal ? `<div class="pill">${escapeHtml(p.goal)}</div>` : '';
    const topCharity = p.top_charity ? `<div class="pill">${escapeHtml(p.top_charity)} ‚Ä¢ ${formatNumber(p.charity_count)} orgs</div>` : '<div class="pill" style="background:rgba(239,68,68,0.18);color:#fca5a5">No foundations yet</div>';
    return `
      <tr>
        <td class="rank">#${idx+1}</td>
        <td><div>${escapeHtml(p.name || 'Player')}</div>${goal}</td>
        <td>${escapeHtml(p.state || '')}</td>
        <td>${formatCurrency(p.net)}</td>
        <td>${formatCurrency(p.high_net || p.net)}</td>
        <td>Day ${formatNumber(p.day || 0)}</td>
        <td>${formatNumber(p.rep)}</td>
        <td>${formatNumber(p.happiness || 0)}%</td>
        <td><div>${formatCurrency(p.charity_given || 0)} total</div>${topCharity}</td>
        <td>${formatCurrency(p.taxes_paid || 0)}</td>
      </tr>`;
  }).join('');
}

async function refreshLeaderboard(initial=false){
  try {
    const res = await fetch('/api/leaderboard');
    if (!res.ok) throw new Error(res.statusText);
    const data = await res.json();
    if (Array.isArray(data)) renderLeaderboard(data);
  } catch(err){
    if (!initial) console.warn('Could not refresh leaderboard', err);
  }
}

refreshLeaderboard(true);
setInterval(()=> refreshLeaderboard(false), 45000);
document.addEventListener('visibilitychange', ()=>{ if (!document.hidden) refreshLeaderboard(false); });
</script>
</body>
</html>
